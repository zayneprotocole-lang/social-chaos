generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id          String   @id @default(uuid())
  username    String
  gamesPlayed Int      @default(0)
  createdAt   DateTime @default(now())
}

model Dare {
  id              String   @id @default(uuid())
  content         String
  difficultyLevel Int      // 1-4
  categoryTags    String[] // e.g., ["Alcool", "Soft"]
  penaltyText     String?
  xpReward        Int      @default(10)
}

model Session {
  id        String          @id @default(uuid())
  roomCode  String          @unique
  status    String          // "WAITING", "ACTIVE", "FINISHED"
  settings  Json            // { difficulty: number, tags: string[], timer: number }
  players   SessionPlayer[]
  createdAt DateTime        @default(now())

  // V4.0 New Fields
  roundsTotal       Int      @default(6)
  roundsCompleted   Int      @default(0)
  isProgressiveMode Boolean  @default(false)
  endedAt           DateTime?
  
  // V8.0 History Metadata
  winnerName        String?
  loserName         String?
  roundsPlayed      Int?
  difficultyLabel   String?
  playedAt          DateTime?
}

model SessionPlayer {
  id           String  @id @default(uuid())
  sessionId    String
  session      Session @relation(fields: [sessionId], references: [id])
  name         String
  avatar       String?
  score        Int     @default(0)
  
  jokersLeft   Int     @default(1)
  rerollsLeft  Int     @default(1)
  exchangeLeft Int     @default(1)
  
  isHost       Boolean @default(false)
}
