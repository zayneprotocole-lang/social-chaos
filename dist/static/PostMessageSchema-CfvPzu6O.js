import{a as j,d as k,x as D,u as q,cW as U,cg as L,cX as V,ca as C,d7 as h,j as R}from"./sanity.config-DDbzIdEq.js";function B(n){const{validation:e}=n.type;if(!e)return!1;const r=Array.isArray(e)?e:[e];for(const i of r){let s=!1;const y=new Proxy({},{get:(m,d)=>()=>(d==="required"&&(s=!0),y)});if(typeof i=="function"&&(i(y),s)||typeof i=="object"&&i!==null&&"_required"in i&&i._required==="required")return!0}return!1}function b(n,e){let r=n;for(;r;){if(r.name===e||r.type&&r.type.name===e)return!0;r=r.type}return!1}function W(n){return b(n,"object")||n.jsonType==="object"||"fields"in n}function K(n){return b(n,"array")}function S(n){return b(n,"reference")}function X(n){return b(n,"crossDatasetReference")}function z(n){return b(n,"string")}function G(n){return b(n,"number")}function x(n){let e=n;for(;e;){if(!e.type)return e;e=e.type}}function A(n){return"fields"in n?n.type?A(n.type).concat(n.fields):n.fields:[]}function H(n){const e=new Set;function r(a,l){if(!e.has(a)){if(e.add(a),"fields"in a)for(const t of A(a)){const o=x(t.type);if(o.name==="document"){l.add(o);continue}let u;a.type.type?u=t.type.type.name:"jsonType"in a.type&&(u=t.type.jsonType),(u==="object"||u==="block")&&(S(t.type)?t.type.to.forEach(p=>l.add(p.type)):l.add(t.type)),r(t.type,l)}else if("of"in a)for(const t of a.of)r(t,l)}}const i=new Map;n.getTypeNames().forEach(a=>{const l=n.get(a);if(l===void 0||l.type===null)return;const t=new Set;r(l,t),i.set(l,t),e.clear()});const s=[],y=new Set,m=new Set;function d(a){if(m.has(a)||y.has(a))return;y.add(a);const l=i.get(a);l!==void 0&&l.forEach(t=>d(t)),y.delete(a),m.add(a),s.includes(a.name)||s.unshift(a.name)}for(const[a]of i)d(a);return s}function J(n){const e=k.c(2),{schemaType:r}=n,i=r.icon;let s;return e[0]!==i?(s=i?j.isValidElement(i)?i:R.jsx(i,{}):null,e[0]=i,e[1]=s):s=e[1],s}const Q=n=>({_id:{type:"objectField",name:"_id",value:{type:"string"}},_type:{type:"objectField",name:"_type",value:{type:"string",value:n}},_createdAt:{type:"objectField",name:"_createdAt",value:{type:"string"}},_updatedAt:{type:"objectField",name:"_updatedAt",value:{type:"string"}},_rev:{type:"objectField",name:"_rev",value:{type:"string"}}});function Y(n){const e=n.options?.list;return e&&Array.isArray(e)?{type:"union",of:e.map(r=>({type:"string",value:typeof r=="string"?r:r.value}))}:{type:"string"}}function Z(n){const e=n.options?.list;return e&&Array.isArray(e)?{type:"union",of:e.map(r=>({type:"number",value:typeof r=="number"?r:r.value}))}:{type:"number"}}function w(n,e=!1){const r={_ref:{type:"objectField",name:"_ref",value:{type:"string"}},_type:{type:"objectField",name:"_type",value:{type:"string",value:"reference"}},_weak:{type:"objectField",name:"_weak",value:{type:"boolean"},optional:!0}};return e&&(r._key={type:"objectField",name:"_key",value:{type:"string"}}),{type:"object",fields:r,dereferencesTo:n}}function T(n){const e=ee(n);return e.length===1?w(e[0]):{type:"union",of:e.map(r=>({type:"unionOption",name:r,value:w(r)}))}}function ee(n){const e=N(n);return[...new Set(e.map(r=>r.name))]}function N(n){const e="to"in n?n.to:[];return"type"in n&&S(n.type)?[...N(n.type),...e]:e}const _=new Map([["text",{type:"string"}],["url",{type:"string"}],["datetime",{type:"string"}],["date",{type:"string"}],["boolean",{type:"boolean"}],["email",{type:"string"}]]);function te(n){const e=new Set,{schema:r,basePath:i}=n;return H(r).map(t=>{const o=r.get(t);if(o===void 0)return;const u=y(o);if(u!==null)return u.type==="type"&&e.add(o),u}).filter(t=>t!==void 0);function s(t){if(t.icon)return h.renderToString(R.jsx(J,{schemaType:t}))}function y(t){let o;if(t.type?o=t.type.name:"jsonType"in t&&(o=t.jsonType),o==="document"){const p=m(t);return p.type==="unknown"?null:{type:"document",name:t.name,title:typeof t.title=="string"?t.title:void 0,icon:s(t),fields:{...Q(t.name),...p.fields}}}const u=d(t);return u.type==="unknown"?null:u.type==="object"?{name:t.name,type:"type",value:{type:"object",fields:{_type:{type:"objectField",name:"_type",value:{type:"string",value:t.name}},...u.fields}}}:{name:t.name,title:typeof t.title=="string"?t.title:void 0,type:"type",value:u}}function m(t){const o={};for(const u of A(t)){const p=d(u.type);p!==null&&(o[u.name]={type:"objectField",name:u.name,title:typeof u.type.title=="string"?u.type.title:void 0,value:p,optional:B(u)===!1})}return{type:"object",fields:o}}function d(t){if(x(t)?.name==="document")return w(t.name);if(e.has(t.type))return{type:"inline",name:t.type.name};if(t.type?.type?.name==="object")return{type:"inline",name:t.type.name};if(z(t))return Y(t);if(G(t))return Z(t);const o=_.get(t.type?.name||"");if(o)return o;if(t.type&&_.has(t.type.name))return _.get(t.type.name);if(X(t))return{type:"unknown"};if(S(t))return T(t);if(K(t))return l(t);if(W(t))return m(t);throw new Error(`Type "${t.name}" not found`)}function a(t,o){const{options:u}=t;if(!u)return;const p={...u};return u.insertMenu&&(p.insertMenu={...u.insertMenu,views:u.insertMenu.views?.map(g=>g.name==="grid"?{name:"grid",previewImageUrls:g.previewImageUrl?o.reduce((f,{name:c})=>{const v=g.previewImageUrl?.(c);if(!v)return f;try{new URL(v),f[c]=v}catch{f[c]=new URL(v,`${window.location.origin}${i?`${i}/`:""}`).toString()}return f},{}):void 0}:g)}),p}function l(t){const o=[];for(const f of t.of){let c=d(f);const v={type:"unionOption",icon:s(f),name:f.name,title:typeof f.title=="string"?f.title:void 0,value:c};c.type==="inline"?c={type:"object",fields:{_key:F()},rest:c}:c.type==="object"&&(c.rest={type:"object",fields:{_key:F()}}),v.value=c,o.push(v)}if(o.length===0)return{type:"null"};if(o.length>1)return{type:"union",of:o,options:a(t,o)};const{name:u,title:p,value:g}=o[0];return{type:"array",of:{type:"arrayItem",name:u,title:typeof p=="string"?p:void 0,value:g}}}}function F(){return{type:"objectField",name:"_key",value:{type:"string"}}}function ne(n){const e=n.reduce((r,{id:i,path:s})=>(r[i]?r[i].add(s):r[i]=new Set([s]),r),{});return Object.entries(e)}function re(n){const e=k.c(11),{comlink:r,perspective:i}=n,s=D();let y,m;e[0]!==r||e[1]!==s?(y=()=>{try{const o=te(s);return r.post("presentation/schema",{schema:o}),r.on("visual-editing/schema",()=>({schema:o}))}catch{return}},m=[r,s],e[0]=r,e[1]=s,e[2]=y,e[3]=m):(y=e[2],m=e[3]),j.useEffect(y,m);let d;e[4]!==i?(d=V(i)?U:{apiVersion:L},e[4]=i,e[5]=d):d=e[5];const a=q(d);let l,t;return e[6]!==a||e[7]!==r||e[8]!==i?(l=()=>r.on("visual-editing/schema-union-types",async o=>{const u=ne(o.paths),p=await Promise.all(u.map(async f=>{const[c,v]=f,E=Array.from(v),I=`*[_id == $id][0]{${E.map(oe).join(",")}}`,M=await a.fetch(I,{id:C(c)},{tag:"presentation-schema",perspective:i}),O=E.map((P,$)=>({path:P,type:M[$]}));return{id:c,paths:O}})),g=new Map;return p.forEach(f=>{g.set(f.id,new Map(f.paths.map(ie)))}),{types:g}}),t=[r,a,i],e[6]=a,e[7]=r,e[8]=i,e[9]=l,e[10]=t):(l=e[9],t=e[10]),j.useEffect(l,t),null}function ie(n){const{path:e,type:r}=n;return[e,r]}function oe(n,e){return`"${e}": ${n}[0]._type`}var ae=j.memo(re);export{ae as default};
